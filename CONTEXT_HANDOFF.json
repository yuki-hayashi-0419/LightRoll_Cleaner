{
  "project": {
    "name": "LightRoll_Cleaner",
    "description": "写真・動画ライブラリのクリーンアップツール（iOS）",
    "created_at": "2025-11-27",
    "version": "0.4.0",
    "tech_stack": ["Swift", "SwiftUI", "Photos Framework", "Vision Framework", "StoreKit 2"],
    "platform": "iOS",
    "min_deployment_target": "iOS 17.0"
  },
  "current_phase": {
    "phase": "implementation_phase_2",
    "description": "Phase 2（データ層）進行中 - M2完了、M3 9/13完了",
    "next_phase": "implementation_phase_2_completion"
  },
  "last_session": {
    "date": "2025-11-29",
    "session_id": "context-opt-001",
    "completed_tasks": [
      "コンテキスト最適化実行"
    ],
    "completed_task_count": 0,
    "context_optimization": {
      "actions_taken": [
        "TASKS.md最適化（完了タスクM3-T07〜T09を簡潔化、3行削減）",
        "サマリー更新（進捗29.7%反映、残時間137.5h）",
        "PROGRESS.md確認（最適化済み - 直近10エントリのみ保持中）"
      ],
      "size_before": "531行（PROGRESS 307行 + TASKS 224行）",
      "size_after": "528行（PROGRESS 307行 + TASKS 221行）",
      "reduction": "3行削減（TASKS.mdから完了タスク詳細を簡潔化）",
      "next_trigger": "M3-T10完了時 または M3モジュール完了時（13タスク）"
    }
  },
  "previous_session": {
    "date": "2025-11-29",
    "session_id": "impl-012",
    "completed_tasks": ["M3-T09: スクリーンショット検出実装 (105/120点)"],
    "test_results": "1140テスト全パス"
  },
  "cumulative_progress": {
    "total_completed_tasks": 35,
    "total_tasks": 118,
    "completion_percentage": 29.7,
    "total_tests": 1140,
    "all_tests_passing": true,
    "notes": "全テストパス - M3スクリーンショット検出完了（9/13タスク）"
  },
  "next_session": {
    "recommended_start": "development_continue",
    "recommended_action": "continue_m3_photo_grouper",
    "start_instructions": [
      "1. CONTEXT_HANDOFF.jsonを読み、前回の状態を確認",
      "2. M3-T10 (PhotoGrouper)実装を開始",
      "3. 全検出サービス統合: 類似度、顔検出、ブレ検出、スクリーンショット検出を統合したグルーピングエンジン実装"
    ],
    "priority_tasks": [
      "M3-T10: PhotoGrouper実装（6種類グルーピング統合：similar/selfie/blurry/screenshot/largeVideo/duplicate）",
      "M3-T11: BestShotSelector実装（品質スコアベース最適写真選定）",
      "M3-T12: AnalysisRepository統合（全分析機能の統合リポジトリ）"
    ],
    "optional_parallel_tasks": [
      "M4-T05: PhotoThumbnail実装（UI層先行着手可）",
      "M4-T06: PhotoGrid実装"
    ],
    "blockers": [],
    "prerequisites": []
  },
  "modules": {
    "completed": [
      {"id": "M1", "name": "Core Infrastructure", "completed_tasks": 10, "total_tasks": 10, "status": "completed", "completion_date": "2025-11-28"},
      {"id": "M2", "name": "Photo Access & Scanning", "completed_tasks": 12, "total_tasks": 12, "status": "completed", "completion_date": "2025-11-28", "average_score": "111.5/120"}
    ],
    "in_progress": [
      {"id": "M3", "name": "Image Analysis & Grouping", "completed_tasks": 9, "total_tasks": 13, "status": "in_progress", "remaining": ["M3-T10", "M3-T11", "M3-T12", "M3-T13"]},
      {"id": "M4", "name": "UI Components", "completed_tasks": 4, "total_tasks": 14, "status": "in_progress", "remaining": ["M4-T05", "M4-T06", "M4-T07", "M4-T08", "M4-T09", "M4-T10", "M4-T11", "M4-T12", "M4-T13", "M4-T14"]}
    ],
    "pending": [
      {"id": "M5", "name": "Dashboard & Statistics", "tasks": 13, "hours": 24, "status": "pending"},
      {"id": "M6", "name": "Deletion & Safety", "tasks": 14, "hours": 25, "status": "pending"},
      {"id": "M7", "name": "Notifications", "tasks": 13, "hours": 17.5, "status": "pending"},
      {"id": "M8", "name": "Settings & Preferences", "tasks": 14, "hours": 21, "status": "pending"},
      {"id": "M9", "name": "Monetization", "tasks": 15, "hours": 25.5, "status": "pending"}
    ]
  },
  "implementation_phases": [
    {
      "phase": 1,
      "name": "基盤構築",
      "modules": ["M1", "M4前半"],
      "tasks": "M1-T01〜M1-T10, M4-T01〜M4-T04",
      "status": "completed",
      "progress": {
        "completed_tasks": 14,
        "total_tasks": 14,
        "percentage": 100
      }
    },
    {
      "phase": 2,
      "name": "データ層",
      "modules": ["M2", "M3"],
      "tasks": "M2-T01〜M2-T12, M3-T01〜M3-T13",
      "status": "in_progress",
      "progress": {
        "completed_tasks": 21,
        "total_tasks": 25,
        "percentage": 84,
        "notes": "M2完了、M3 9/13完了（全検出サービス完了、グルーピングエンジン実装待ち）"
      }
    },
    {
      "phase": 3,
      "name": "UI層",
      "modules": ["M4後半", "M5"],
      "tasks": "M4-T05〜M4-T14, M5-T01〜M5-T13",
      "status": "pending"
    },
    {
      "phase": 4,
      "name": "機能完成",
      "modules": ["M6", "M8"],
      "tasks": "M6-T01〜M6-T14, M8-T01〜M8-T14",
      "status": "pending"
    },
    {
      "phase": 5,
      "name": "仕上げ",
      "modules": ["M7", "M9", "テスト"],
      "tasks": "M7-T01〜M7-T13, M9-T01〜M9-T15",
      "status": "pending"
    }
  ],
  "mcp_status": {
    "installed": ["xcodebuildmcp"],
    "pending": [],
    "configured": true,
    "note": "xcodebuildmcp連携設定済み - ビルド/テスト実行に活用"
  },
  "context_optimization": {
    "last_optimized": "2025-11-29",
    "optimization_session": "context-opt-001",
    "session_count": 17,
    "completed_task_count": 35,
    "progress_entries_count": 10,
    "archived_tasks_count": 35,
    "archived_modules": ["M1", "M2"],
    "context_usage_estimate": "moderate (42.6%)",
    "document_sizes": {
      "PROGRESS.md": "307行（最適化済み - 直近10エントリ保持）",
      "TASKS.md": "221行（完了タスク簡潔化済み）",
      "total_primary_docs": "528行"
    },
    "actions_this_session": [
      "TASKS.md最適化（完了タスクM3-T07〜T09を簡潔化）",
      "サマリー更新（進捗29.7%、残時間137.5h反映）",
      "PROGRESS.md確認（既に最適化済みを確認）",
      "CONTEXT_HANDOFF.json更新（最新状態反映）"
    ],
    "size_reduction": "3行削減（531→528行）",
    "next_optimization_trigger": "M3モジュール完了時（残4タスク） または 45タスク完了時",
    "notes": "PROGRESS.mdは既に直近10エントリのみ保持で最適化済み。次回はM3完了時に実施推奨。"
  },
  "quality_metrics": {
    "total_tests": 1140,
    "tests_passed": 1140,
    "tests_failed": 0,
    "average_score": 107.3,
    "passing_threshold": 96,
    "all_tasks_passing": true,
    "notes": "全テストパス - 高い品質を維持（M3-T09: 105点）"
  },
  "file_structure": {
    "docs/CRITICAL": "重要ドキュメント（常時読み込み推奨）",
    "docs/modules": "モジュール仕様書（必要時に参照）",
    "docs/archive": "アーカイブ済みドキュメント",
    "LightRoll_Cleaner": "メインアプリケーションソース",
    "LightRoll_CleanerPackage": "SPM Feature Package",
    "tests": "テストコード"
  },
  "quick_reference": {
    "architecture": "docs/CRITICAL/ARCHITECTURE.md",
    "rules": "docs/CRITICAL/CORE_RULES.md",
    "tasks": "docs/TASKS.md",
    "progress": "docs/PROGRESS.md"
  },
  "dependencies": {
    "external": [
      {"name": "Google Mobile Ads SDK", "version": "latest", "module": "M9", "required": false}
    ],
    "internal": []
  },
  "known_issues": [
    {
      "id": "PERF-001",
      "description": "パフォーマンステスト1件が不安定（タイミング依存）",
      "severity": "low",
      "status": "known",
      "workaround": "機能テストには影響なし"
    }
  ],
  "notes": [
    "プロジェクト初期化完了（2025-11-27）",
    "設計ドキュメント完成（2025-11-27）",
    "アーキテクチャ選定完了: MVVM + Repository Pattern（2025-11-27）",
    "Phase 1完了（2025-11-28）: M1 10/10, M4 4/14",
    "Phase 2進行中（2025-11-28〜）: M2 12/12完了, M3 9/13完了（全検出サービス完了）",
    "impl-007: 2タスク完了、964テスト、平均品質スコア113.5点（2025-11-28）",
    "impl-008: 3タスク完了、1026テスト、平均品質スコア107点（2025-11-28）",
    "impl-009: 1タスク完了、1053テスト、品質スコア108点（2025-11-28）",
    "impl-010: 1タスク完了、1093テスト、品質スコア113点（2025-11-28）",
    "impl-011: 1タスク完了、1116テスト、品質スコア107点（2025-11-28）",
    "impl-012: 1タスク完了、1140テスト、品質スコア105点（2025-11-29）",
    "context-opt-001: コンテキスト最適化実行、528行維持（2025-11-29）",
    "累計進捗: 35/118タスク完了 (29.7%)"
  ]
}
