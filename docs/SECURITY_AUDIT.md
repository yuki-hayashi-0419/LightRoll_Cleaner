# セキュリティ監査

このファイルは、セキュリティ要件の遵守状況を記録します。

---

## 監査ステータス

**最終監査日**: 2025-11-27（設計レビュー）
**監査者**: 設計フェーズ自動生成
**ステータス**: 設計段階 - 実装後に再監査必要

---

## 1. データ保護

### 1.1 写真データの取り扱い

| 項目 | 要件 | 実装状況 | 確認日 |
|------|------|----------|--------|
| オンデバイス処理 | 全ての画像分析はデバイス上で実行 | 設計済 | 2025-11-27 |
| ネットワーク送信禁止 | 写真データを外部に送信しない | 設計済 | 2025-11-27 |
| サムネイルのみ保持 | 分析用にサムネイルを使用 | 設計済 | 2025-11-27 |
| ゴミ箱データ暗号化 | アプリ内ゴミ箱は暗号化保存 | 設計済 | 2025-11-27 |

### 1.2 ユーザーデータ

| 項目 | 要件 | 実装状況 | 確認日 |
|------|------|----------|--------|
| 設定データ | UserDefaultsでローカル保存 | 設計済 | 2025-11-27 |
| 課金情報 | StoreKit経由のみ、アプリ保存なし | 設計済 | 2025-11-27 |
| 分析キャッシュ | デバイスローカルのみ | 設計済 | 2025-11-27 |

---

## 2. 権限管理

### 2.1 必要な権限

| 権限 | 用途 | 必須/任意 | Info.plist設定 |
|------|------|-----------|----------------|
| Photos | 写真ライブラリへのアクセス | 必須 | NSPhotoLibraryUsageDescription |
| Notifications | リマインダー・アラート | 任意 | 設定不要（実行時リクエスト） |

### 2.2 権限フロー確認項目

| 項目 | 要件 | 実装状況 |
|------|------|----------|
| 初回起動時の権限説明 | 用途を明確に説明 | 設計済 |
| 権限拒否時のフォールバック | 適切なエラー表示と設定誘導 | 設計済 |
| 最小権限の原則 | 必要最小限の権限のみリクエスト | 設計済 |
| 権限取り消し後の動作 | 次回起動時に再確認 | 設計済 |

---

## 3. プライバシー

### 3.1 App Privacy Label（App Store Connect）

| カテゴリ | 収集するデータ | 用途 |
|----------|---------------|------|
| 識別子 | なし | - |
| 使用状況データ | なし | - |
| 診断 | クラッシュログ（匿名化） | アプリ改善 |
| 購入 | StoreKit経由のみ | 課金処理 |

### 3.2 トラッキング

| 項目 | 状態 |
|------|------|
| ATT (App Tracking Transparency) | 不使用 |
| サードパーティトラッキング | なし |
| 広告ID利用 | AdMobのみ（広告表示目的） |

---

## 4. ネットワークセキュリティ

### 4.1 通信

| 項目 | 要件 | 実装状況 |
|------|------|----------|
| 写真データ送信 | 禁止 | 設計済 |
| App Store通信 | StoreKit 2（HTTPS） | 設計済 |
| 広告通信 | AdMob SDK（HTTPS） | 設計済 |
| クラッシュレポート | 匿名化データのみ | 設計済 |

### 4.2 ATS (App Transport Security)

```xml
<!-- Info.plist -->
<key>NSAppTransportSecurity</key>
<dict>
    <key>NSAllowsArbitraryLoads</key>
    <false/>
</dict>
```

---

## 5. 脆弱性チェックリスト

### 5.1 入力バリデーション

| 項目 | チェック | 状態 |
|------|----------|------|
| ユーザー入力のサニタイズ | 設定画面の入力値 | 設計済 |
| ファイルパス検証 | ゴミ箱操作時 | 設計済 |
| 数値範囲チェック | 閾値設定 | 設計済 |

### 5.2 認証・認可

| 項目 | チェック | 状態 |
|------|----------|------|
| 課金状態の検証 | StoreKitで確認 | 設計済 |
| レシート検証 | App Store Server API | 設計済 |
| 機能制限バイパス対策 | サーバーサイド検証推奨 | 要検討 |

### 5.3 データ保護

| 項目 | チェック | 状態 |
|------|----------|------|
| Keychain使用 | センシティブデータなし | 不要 |
| ファイル保護属性 | ゴミ箱データ | 設計済 |
| バックアップ除外 | キャッシュデータ | 設計済 |

---

## 6. サードパーティライブラリ

### 6.1 使用ライブラリ

| ライブラリ | バージョン | 用途 | セキュリティ確認 |
|-----------|-----------|------|-----------------|
| Google Mobile Ads SDK | 最新 | 広告表示 | Google提供 |

### 6.2 依存関係監査

- [ ] 定期的な依存関係アップデート
- [ ] 脆弱性データベースとの照合
- [ ] ライセンス確認

---

## 7. インシデント対応

### 7.1 対応フロー

1. **検知**: ユーザーレポート / 自動監視
2. **評価**: 影響範囲の特定
3. **対応**: 修正パッチの作成
4. **通知**: 必要に応じてユーザー通知
5. **改善**: 再発防止策の実施

### 7.2 連絡先

- セキュリティ問題報告: [設定予定]
- プライバシー問い合わせ: [設定予定]

---

## 8. 監査履歴

| 日付 | 監査種別 | 結果 | 備考 |
|------|----------|------|------|
| 2025-11-27 | 設計レビュー | 合格 | 実装後に再監査必要 |

---

## 9. 推奨事項

### 9.1 実装時の注意点

- [ ] ゴミ箱データの暗号化にはData Protection APIを使用
- [ ] 課金状態はStoreKitの`Transaction.currentEntitlements`で常に確認
- [ ] クラッシュレポートは個人を特定できる情報を除外
- [ ] 広告SDKの初期化は同意取得後（GDPR対応が必要な場合）

### 9.2 今後の監査予定

| 時期 | 監査項目 |
|------|----------|
| Alpha版完成時 | 実装コードレビュー |
| Beta版完成時 | ペネトレーションテスト |
| リリース前 | 最終セキュリティ監査 |
| 定期 | 四半期ごとの依存関係監査 |

---

*最終更新: 2025-11-27*
